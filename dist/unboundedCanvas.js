!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).unboundedCanvas=e()}(this,(function(){"use strict";var t=function(){return t=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},t.apply(this,arguments)};function e(t,e={}){return function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function h(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,h)}a((n=n.apply(t,e||[])).next())}))}(this,void 0,void 0,(function*(){const{mode:i="random",handler:n,onUpdate:o}=e;let s=n?.99:1;const r=n?n():Promise.resolve(),h=yield function(t=0,e,i){var n;let o=0;const s={ease:e=>Math.pow(e/t,4),"ease-in":e=>Math.pow(e/t,2),"ease-in-out":e=>{let i=e/(t/2);return i<1?Math.pow(i,2)/2:-(--i*(i-2)-1)/2},"ease-out":e=>-e/t*(e/t-2),linear:e=>e/t,random:e=>o+Math.pow(Math.random()*(e/t)*(1-o),3)},r=Object.keys(s),h="random"===e?s[r[Math.floor(Math.random()*r.length)]]:null!==(n=s[e])&&void 0!==n?n:s.random;return new Promise((e=>{let n=(new Date).getTime(),s=0;const r=()=>{!function(t){if("undefined"!=typeof window)return window.requestAnimationFrame(t);const e=setTimeout((()=>{t(),clearTimeout(e)}),16.6)}((()=>{s=(new Date).getTime()-n,o=h(s),s>=t?(null==i||i(1),e(s)):(null==i||i(o),r())}))};r()}))}(t,i,(t=>{null==o||o(Math.round(t*s*1e4)/1e4)})),[a]=yield Promise.all([r,h]);return n&&(null==o||o(1)),a}))}return{Canvas:function(){function i(e,i){this.zoom=1,this.devicePixelRatio=window.devicePixelRatio,this.fillPoints=[];var n=i.width,o=i.height;e.width=n*this.devicePixelRatio,e.height=o*this.devicePixelRatio,e.style.width="100%",e.style.height="100%",this.element=e,this.element.style.cursor="grab",this.canvasCenter={x:this.element.width/this.devicePixelRatio/2,y:this.element.height/this.devicePixelRatio/2},this.contentCenter=t({},this.canvasCenter),this.ctx=e.getContext("2d"),this.fillPoints.push({point:[3,-3],fill:"#333"},{point:[0,0],fill:"pink"},{point:[6,-6],fill:"pink"},{point:[-6,6],fill:"pink"}),this.render(),this.initMoveListener(),this.initZoomListener(),this.initClickListener()}return i.prototype.getOptions=function(){var t=16*this.zoom*this.devicePixelRatio,e=2*this.zoom*this.devicePixelRatio;return{gap:e,size:t,halfSize:t/2,unitSize:t+e}},i.prototype.getCroodsFromView=function(t,e){var i=this.getOptions(),n=i.unitSize,o=i.halfSize,s=t-this.canvasCenter.x,r=e-this.canvasCenter.y,h=s+(this.canvasCenter.x-this.contentCenter.x),a=r+(this.canvasCenter.y-this.contentCenter.y);return[Math.floor((h*this.devicePixelRatio+o)/n),Math.floor((a*this.devicePixelRatio+o)/n)]},i.prototype.getCroodsFromContent=function(t,e){var i=this.getOptions().unitSize,n=t*i/this.devicePixelRatio,o=e*i/this.devicePixelRatio,s=n-(this.canvasCenter.x-this.contentCenter.x),r=o-(this.canvasCenter.y-this.contentCenter.y);return{x:s+this.canvasCenter.x,y:r+this.canvasCenter.y}},i.prototype.drawPoint=function(t,e,i){if(void 0===i&&(i=this.contentCenter),this.ctx){var n=this.getOptions(),o=n.size,s=n.unitSize,r=n.halfSize;if(this.ctx.save(),e&&(this.ctx.fillStyle=e),Array.isArray(t)){var h=t[0],a=t[1];this.drawRect(i.x*this.devicePixelRatio+h*s-r,i.y*this.devicePixelRatio+a*s-r,o,o)}else{h=t.x,a=t.y;this.drawRect(h-r,a-r,o,o)}this.ctx.restore()}},i.prototype.drawLine=function(t,e){var i,n;this.ctx&&(this.ctx.save(),this.ctx.beginPath(),(i=this.ctx).moveTo.apply(i,t),(n=this.ctx).lineTo.apply(n,e),this.ctx.strokeStyle="red",this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.setLineDash([5,5]),this.ctx.stroke(),this.ctx.restore())},i.prototype.drawRect=function(t,e,i,n,o){if(void 0===o&&(o=1*this.devicePixelRatio*this.zoom),this.ctx){var s=i>2*o?o:0;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t+s,e),this.ctx.lineTo(t+i-s,e),this.ctx.arcTo(t+i,e,t+i,e+s,o),this.ctx.lineTo(t+i,e+n-s),this.ctx.arcTo(t+i,e+n,t+i-s,e+n,o),this.ctx.lineTo(t+s,e+n),this.ctx.arcTo(t,e+n,t,e+n-s,o),this.ctx.lineTo(t,e+s),this.ctx.arcTo(t,e,t+s,e,o),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}},i.prototype.render=function(t){var e=this;return void 0===t&&(t=this.contentCenter),new Promise((function(i,n){window.requestAnimationFrame((function(){if(!e.ctx)return n();e.ctx.clearRect(0,0,e.element.width,e.element.height);var o,s,r,h=e.getOptions(),a=h.size,c=h.unitSize,l=h.halfSize,d=(o=t.x*e.devicePixelRatio-l,s=t.y*e.devicePixelRatio-l,r=Math.ceil(s/c),{x:o-Math.ceil(o/c)*c,y:s-r*c});e.ctx.fillStyle="#f2f2f2";for(var f=d.y;f<e.element.height+a;f+=c)for(var v=d.x;v<e.element.width+a;v+=c)e.drawRect(v,f,a,a);e.fillPoints.forEach((function(i){var n=i.point,o=i.fill;e.drawPoint(n,o,t)})),e.drawLine([e.element.width/2,0],[e.element.width/2,e.element.height]),e.drawLine([0,e.element.height/2],[e.element.width,e.element.height/2]),i()}))}))},i.prototype.handleZoom=function(t,e){void 0===e&&(e=this.canvasCenter);var i=this.zoom;this.zoom=t;var n=this.contentCenter.x-e.x,o=this.contentCenter.y-e.y,s=n/i*this.zoom,r=o/i*this.zoom;this.contentCenter={x:this.contentCenter.x+(s-n),y:this.contentCenter.y+(r-o)},this.render()},i.prototype.initMoveListener=function(){var t=this,e=function(e){void 0!==t.moveInitPoint&&(t.contentCenter={x:t.contentCenter.x+e.offsetX-t.moveInitPoint.x,y:t.contentCenter.y+e.offsetY-t.moveInitPoint.y},t.render(),t.moveInitPoint=void 0,t.element.style.cursor="grab")};this.element.addEventListener("mousedown",(function(e){t.moveInitPoint={x:e.offsetX,y:e.offsetY},t.element.style.cursor="grabbing"})),this.element.addEventListener("mousemove",(function(e){if(void 0!==t.moveInitPoint){var i={x:t.contentCenter.x+e.offsetX-t.moveInitPoint.x,y:t.contentCenter.y+e.offsetY-t.moveInitPoint.y};t.render(i)}})),this.element.addEventListener("mouseup",e),this.element.addEventListener("mouseleave",e)},i.prototype.initZoomListener=function(){var t=this;this.element.addEventListener("wheel",(function(e){if(!t.moveInitPoint){var i=e.offsetX,n=e.offsetY,o=e.deltaY,s=Math.pow(.999,o/2),r=Math.min(Math.max(t.zoom*s,5/16),6.25);t.handleZoom(r,{x:i,y:n})}}))},i.prototype.initClickListener=function(){var t=this;this.element.addEventListener("click",(function(e){var i=e.offsetX,n=e.offsetY;t.fillPoints.push({point:t.getCroodsFromView(i,n),fill:"pink"}),t.render()}))},i.prototype.backToCenter=function(i){var n=this;void 0===i&&(i=1500);var o=t({},this.contentCenter),s=this.contentCenter.x-this.canvasCenter.x,r=this.contentCenter.y-this.canvasCenter.y,h=!0;e(i,{mode:"ease-in-out",onUpdate:function(t){n.contentCenter={x:o.x-s*t,y:o.y-r*t},h&&(h=!1,n.render().then((function(){h=!0})))}})},i}()}}));
